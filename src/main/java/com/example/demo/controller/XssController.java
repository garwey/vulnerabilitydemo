package com.example.demo.controller;

import com.example.demo.DemoApplication;
import com.example.demo.entity.User;
import com.example.demo.service.UserService;
import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.util.EntityUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import javax.servlet.http.HttpServletRequest;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.URL;
import java.net.URLConnection;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;

@Controller
@RequestMapping("/xss")
public class XssController {
    @Autowired
    private UserService userService;

    @GetMapping(value = "/reflected")
    public String reflected(HttpServletRequest request) {
        String message = request.getParameter("message");
        request.setAttribute("message1", message);
        return "XSS";
    }

    @GetMapping(value = "/stored")
    public String stored(HttpServletRequest request) throws Exception {
        String name = request.getParameter("name");
        String message = request.getParameter("message");
        User user = new User(name,message);
        userService.insertOne(user);
        return "XSS";
    }

    @GetMapping(value = "/search")
    public String search(HttpServletRequest request) throws Exception {
        String name = request.getParameter("name");
        String message = userService.getByName(name).get(0).getDescription();
        request.setAttribute("message2", message);
        return "XSS";
    }
}
